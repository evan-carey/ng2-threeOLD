<script type="x-shader/x-vertex" id="vert">
#ifdef GL_ES
precision highp float;
#endif

// switch on high precision floats
		#ifdef GL_ES
		precision highp float;
		#endif
		
		uniform float amplitude;
		attribute float displacement;
		varying vec3 vNormal;
		varying vec3 vColor;
		void main() {
			
			vNormal = normal;
			vColor = color;
			// multiply our displacement by the
			// amplitude. The amp will get animated
			// so we'll have animated displacement
			vec3 newPosition = position + 
							   normal * 
							   vec3(displacement *
									amplitude);

			gl_Position = projectionMatrix *
						  modelViewMatrix *
						  vec4(newPosition,1.0);
		}
</script>
<script type="x-shader/x-fragment" id="frag">
#ifdef GL_ES
		precision highp float;
		#endif
		
		// same name and type as VS
		varying vec3 vNormal;
		varying vec3 vColor;
		void main() {

			// calc the dot product and clamp
			// 0 -> 1 rather than -1 -> 1
			vec3 light = vec3(0.0,0.0,1.0);
			
			// ensure it's normalized
			light = normalize(light);
			
			float dProd = max(0.8, dot(vNormal, light));
			//float dProd = dot(vNormal, light);
			
			// feed into our frag colour
			gl_FragColor = vec4(vColor.x * dProd, vColor.y * dProd, vColor.z * dProd, 1.0);
			//gl_FragColor = vec4(dProd, dProd, dProd, 1.0);
			
		}
</script>